from unittest import TestCase
from binascii import b2a_hex
from sqlalchemy import (create_engine, MetaData, Table, Column, Integer, String,
        Numeric, func, literal, select)
from sqlalchemy.orm import sessionmaker, column_property, mapper

from geoalchemy import (Geometry, GeometryCollection, GeometryColumn,
        GeometryDDL, WKTSpatialElement, WKBSpatialElement)

engine = create_engine('postgres://gis:gis@localhost/gis', echo=True)
metadata = MetaData(engine)
session = sessionmaker(bind=engine)()

roads_table = Table('roads', metadata,
    Column('road_id', Integer, primary_key=True),
    Column('road_name', String),
    Column('road_geom', Geometry(2))
)

lakes_table = Table('lakes', metadata,
    Column('lake_id', Integer, primary_key=True),
    Column('lake_name', String),
    Column('lake_geom', Geometry(2))
)

spots_table = Table('spots', metadata,
    Column('spot_id', Integer, primary_key=True),
    Column('spot_height', String),
    Column('spot_location', Geometry(2))
)

class Road(object):
    pass

class Lake(object):
    pass

class Spot(object):
    pass

mapper(Road, roads_table)
mapper(Lake, lakes_table)
mapper(Spot, spots_table)

# enable the DDL extension, which allows CREATE/DROP operations
# to work correctly.  This is not needed if working with externally
# defined tables.    
GeometryDDL(roads_table)
GeometryDDL(lakes_table)
GeometryDDL(spots_table)

metadata.drop_all()
metadata.create_all()

r = Road()
r.road_name='Jeff Rd'
r.road_geom=WKTSpatialElement('LINESTRING(-88.9139332929936 42.5082802993631,-88.8203027197452 42.5985669235669,-88.7383759681529 42.7239650127389,-88.6113059044586 42.9680732929936,-88.3655256496815 43.1402866687898)')
session.add(r)
r = Road()
r.road_name='Peter Rd'
r.road_geom=WKTSpatialElement('LINESTRING(-88.9139332929936 42.5082802993631,-88.8203027197452 42.5985669235669,-88.7383759681529 42.7239650127389,-88.6113059044586 42.9680732929936,-88.3655256496815 43.1402866687898)')
session.add(r)
r = Road()
r.road_name='Geordie Rd'
r.road_geom=WKTSpatialElement('LINESTRING(-89.2232485796178 42.6420382611465,-89.2449842484076 42.9179140573248,-89.2316084522293 43.106847178344,-89.0710987261147 43.243949044586,-89.092834566879 43.2957802993631,-89.092834566879 43.2957802993631,-89.0309715095541 43.3175159681529)')
session.add(r)
r = Road()
r.road_name='Paul St'
r.road_geom=WKTSpatialElement('LINESTRING(-88.2652071783439 42.5584395350319,-88.1598727834395 42.6269904904459,-88.1013536751592 42.621974566879,-88.0244428471338 42.6437102356688,-88.0110670509554 42.6771497261147)')
session.add(r)
r = Road()
r.road_name='Graeme Ave'
r.road_geom=WKTSpatialElement('LINESTRING(-88.5477708726115 42.6988853949045,-88.6096339299363 42.9697452675159,-88.6029460318471 43.0884554585987,-88.5912422101911 43.187101955414)')
session.add(r)
r = Road()
r.road_name='Phil Tce'
r.road_geom=WKTSpatialElement('LINESTRING(-88.9356689617834 42.9363057770701,-88.9824842484076 43.0366242484076,-88.9222931656051 43.1085191528662,-88.8487262866242 43.0449841210191)')
session.add(r)
l = Lake()
l.lake_name='My Lake'
l.lake_geom=WKTSpatialElement('POLYGON((-88.7968950764331 43.2305732929936,-88.7935511273885 43.1553344394904,-88.716640299363 43.1570064140127,-88.7250001719745 43.2339172420382,-88.7968950764331 43.2305732929936))')
session.add(l)
l = Lake()
l.lake_name='Lake White'
l.lake_geom=WKTSpatialElement('POLYGON((-88.1147292993631 42.7540605095542,-88.1548566878981 42.7824840764331,-88.1799363057325 42.7707802547771,-88.188296178344 42.7323248407643,-88.1832802547771 42.6955414012739,-88.1565286624204 42.6771496815287,-88.1448248407643 42.6336783439491,-88.131449044586 42.5718152866242,-88.1013535031847 42.565127388535,-88.1080414012739 42.5868630573248,-88.1164012738854 42.6119426751592,-88.1080414012739 42.6520700636943,-88.0980095541401 42.6838375796178,-88.0846337579618 42.7139331210191,-88.1013535031847 42.7423566878981,-88.1147292993631 42.7540605095542))')
session.add(l)
l = Lake()
l.lake_name='Lake Blue'
l.lake_geom=WKTSpatialElement('POLYGON((-89.0694267515924 43.1335987261147,-89.1078821656051 43.1135350318471,-89.1329617834395 43.0884554140127,-89.1312898089172 43.0466560509554,-89.112898089172 43.0132165605096,-89.0694267515924 42.9898089171975,-89.0343152866242 42.953025477707,-89.0209394904459 42.9179140127389,-89.0042197452229 42.8961783439491,-88.9774681528663 42.8644108280255,-88.9440286624204 42.8292993630573,-88.9072452229299 42.8142515923567,-88.8687898089172 42.815923566879,-88.8687898089172 42.815923566879,-88.8102707006369 42.8343152866242,-88.7734872611465 42.8710987261147,-88.7517515923567 42.9145700636943,-88.7433917197452 42.9730891719745,-88.7517515923567 43.0299363057325,-88.7734872611465 43.0867834394905,-88.7885352038217 43.158678388535,-88.8738057324841 43.1620222929936,-88.947372611465 43.1937898089172,-89.0042197452229 43.2138535031847,-89.0410031847134 43.2389331210191,-89.0710987261147 43.243949044586,-89.0660828025478 43.2238853503185,-89.0543789808917 43.203821656051,-89.0376592356688 43.175398089172,-89.0292993630573 43.1519904458599,-89.0376592356688 43.1369426751592,-89.0393312101911 43.1386146496815,-89.0393312101911 43.1386146496815,-89.0510350318471 43.1335987261147,-89.0694267515924 43.1335987261147))')
session.add(l)
l = Lake()
l.lake_name='Lake Deep'
l.lake_geom=WKTSpatialElement('POLYGON((-88.9122611464968 43.038296178344,-88.9222929936306 43.0399681528663,-88.9323248407643 43.0282643312102,-88.9206210191083 43.0182324840764,-88.9105891719745 43.0165605095542,-88.9005573248408 43.0232484076433,-88.9072452229299 43.0282643312102,-88.9122611464968 43.038296178344))')
session.add(l)
s = Spot()
s.spot_height=420.40
s.spot_location=WKTSpatialElement('POINT(-88.5945861592357 42.9480095987261)')
session.add(s)
s = Spot()
s.spot_height=102.34
s.spot_location=WKTSpatialElement('POINT(-88.9055734203822 43.0048567324841)')
session.add(s)
s = Spot()
s.spot_height=388.62
s.spot_location=WKTSpatialElement('POINT(-89.201512910828 43.1051752038217)')
session.add(s)
s = Spot()
s.spot_height=454.66
s.spot_location=WKTSpatialElement('POINT(-88.3304141847134 42.6269904904459)')
session.add(s)

session.flush()
session.commit()

